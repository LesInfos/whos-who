{"ast":null,"code":"import _asyncToGenerator from \"M:/August Cohort/angular-whos-who-aug-2024-team-4/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport fetchFromSpotify, { request } from \"../../services/api\";\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@angular/common\";\nimport * as i3 from \"@angular/forms\";\nimport * as i4 from \"../components/button/button.component\";\n\nfunction HomeComponent_div_0_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \"Loading...\");\n    i0.ɵɵelementEnd();\n  }\n}\n\nfunction HomeComponent_div_5_option_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"option\", 6);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n\n  if (rf & 2) {\n    const genre_r4 = ctx.$implicit;\n    i0.ɵɵproperty(\"value\", genre_r4);\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\" \", genre_r4, \" \");\n  }\n}\n\nfunction HomeComponent_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \" Genre: \");\n    i0.ɵɵelementStart(2, \"select\", 5);\n    i0.ɵɵlistener(\"ngModelChange\", function HomeComponent_div_5_Template_select_ngModelChange_2_listener($event) {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r5 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r5.selectedGenre = $event);\n    })(\"ngModelChange\", function HomeComponent_div_5_Template_select_ngModelChange_2_listener($event) {\n      i0.ɵɵrestoreView(_r6);\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.setGenre($event));\n    });\n    i0.ɵɵelement(3, \"option\", 6);\n    i0.ɵɵtemplate(4, HomeComponent_div_5_option_4_Template, 2, 2, \"option\", 7);\n    i0.ɵɵelementEnd()();\n  }\n\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngModel\", ctx_r1.selectedGenre);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.genres);\n  }\n}\n\nfunction HomeComponent_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r9 = i0.ɵɵgetCurrentView();\n\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1, \" Difficulty: \");\n    i0.ɵɵelementStart(2, \"select\", 5);\n    i0.ɵɵlistener(\"ngModelChange\", function HomeComponent_div_6_Template_select_ngModelChange_2_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r8 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r8.selectedDifficulty = $event);\n    })(\"ngModelChange\", function HomeComponent_div_6_Template_select_ngModelChange_2_listener($event) {\n      i0.ɵɵrestoreView(_r9);\n      const ctx_r10 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r10.setDifficulty($event));\n    });\n    i0.ɵɵelementStart(3, \"option\", 8);\n    i0.ɵɵtext(4, \"Easy\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"option\", 9);\n    i0.ɵɵtext(6, \"Medium\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"option\", 10);\n    i0.ɵɵtext(8, \"Hard\");\n    i0.ɵɵelementEnd()()();\n  }\n\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngModel\", ctx_r2.selectedDifficulty);\n  }\n}\n\nconst AUTH_ENDPOINT = \"https://nuod0t2zoe.execute-api.us-east-2.amazonaws.com/FT-Classroom/spotify-auth-token\";\nconst TOKEN_KEY = \"whos-who-access-token\";\nexport class HomeComponent {\n  constructor(router) {\n    var _this = this;\n\n    this.router = router;\n    this.genres = [];\n    this.selectedGenre = \"\";\n    this.selectedDifficulty = \"medium\";\n    this.authLoading = false;\n    this.configLoading = false;\n    this.token = \"\";\n    this.artistList = {\n      Pop: [\"Taylor Swift\", \"Justin Bieber\"],\n      Rock: [\"Led Zeppelin\", \"AC/DC\", \"Queen\", \"Beyoncé\"]\n    };\n\n    this.loadGenres = /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (t) {\n        _this.configLoading = true;\n        _this.genres = ['Pop', 'Rock'];\n        _this.configLoading = false;\n      });\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }();\n  }\n\n  ngOnInit() {\n    this.authLoading = true;\n    const storedTokenString = localStorage.getItem(TOKEN_KEY);\n\n    if (storedTokenString) {\n      const storedToken = JSON.parse(storedTokenString);\n\n      if (storedToken.expiration > Date.now()) {\n        console.log(\"Token found in localstorage\");\n        this.authLoading = false;\n        this.token = storedToken.value;\n        this.loadGenres(storedToken.value);\n        return;\n      }\n    }\n\n    console.log(\"Sending request to AWS endpoint\");\n    request(AUTH_ENDPOINT).then(({\n      access_token,\n      expires_in\n    }) => {\n      const newToken = {\n        value: access_token,\n        expiration: Date.now() + (expires_in - 20) * 1000\n      };\n      localStorage.setItem(TOKEN_KEY, JSON.stringify(newToken));\n      this.authLoading = false;\n      this.token = newToken.value;\n      this.loadGenres(newToken.value);\n    });\n  }\n\n  setGenre(selectedGenre) {\n    this.selectedGenre = selectedGenre;\n    console.log(this.selectedGenre); //console.log(TOKEN_KEY);\n  }\n\n  setDifficulty(selectedDifficulty) {\n    this.selectedDifficulty = selectedDifficulty;\n    console.log(this.selectedDifficulty);\n  }\n\n  startGame() {\n    if (!this.selectedGenre || !this.selectedDifficulty) {\n      return;\n    }\n\n    this.fetchTracks();\n  }\n\n  fetchTracks() {\n    const artists = this.artistList[this.selectedGenre];\n    const randomArtist = artists[Math.floor(Math.random() * artists.length)];\n    const endpoint = `search`;\n    const params = {\n      q: `artist:${randomArtist}`,\n      type: \"track\",\n      limit: 1\n    };\n    fetchFromSpotify({\n      token: this.token,\n      endpoint,\n      params\n    }).then(data => {\n      const track = data.tracks.items[0];\n\n      if (track && track.preview_url) {\n        this.navigateToPlayPage(track, artists);\n      } else {\n        console.error(\"No track preview available for the selected artist.\");\n      }\n    }).catch(error => {\n      console.error(\"Error fetching tracks:\", error);\n    });\n  }\n\n  navigateToPlayPage(track, artists) {\n    const numOptions = this.getNumberOfChoices();\n    const correctArtist = track.artists[0].name;\n    const wrongChoices = artists.filter(artist => artist !== correctArtist);\n    const shuffledChoices = this.shuffleArray([...wrongChoices]).slice(0, numOptions - 1);\n    shuffledChoices.push(correctArtist);\n    const options = this.shuffleArray(shuffledChoices);\n    console.log(\"Navigating to play with state:\", {\n      track: track,\n      options: options,\n      correctArtist: correctArtist,\n      genre: this.selectedGenre,\n      token: this.token\n    });\n    this.router.navigate(['play'], {\n      state: {\n        track: track,\n        options: options,\n        correctArtist: correctArtist,\n        genre: this.selectedGenre,\n        token: this.token\n      }\n    });\n  }\n\n  getNumberOfChoices() {\n    switch (this.selectedDifficulty) {\n      case 'easy':\n        return 3;\n\n      case 'medium':\n        return 4;\n\n      case 'hard':\n        return 5;\n\n      default:\n        return 4;\n    }\n  }\n\n  shuffleArray(array) {\n    return array.sort(() => Math.random() - 0.5);\n  }\n\n}\n\nHomeComponent.ɵfac = function HomeComponent_Factory(t) {\n  return new (t || HomeComponent)(i0.ɵɵdirectiveInject(i1.Router));\n};\n\nHomeComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: HomeComponent,\n  selectors: [[\"app-home\"]],\n  decls: 11,\n  vars: 3,\n  consts: [[4, \"ngIf\"], [1, \"main-container\"], [\"buttonText\", \"Play\", 3, \"click\"], [\"buttonText\", \"Leaderboard\", \"routerLink\", \"/leaderboard\"], [\"buttonText\", \"Game Over\", \"routerLink\", \"/gameover\"], [3, \"ngModel\", \"ngModelChange\"], [3, \"value\"], [3, \"value\", 4, \"ngFor\", \"ngForOf\"], [\"value\", \"easy\"], [\"value\", \"medium\"], [\"value\", \"hard\"]],\n  template: function HomeComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵtemplate(0, HomeComponent_div_0_Template, 2, 0, \"div\", 0);\n      i0.ɵɵelementStart(1, \"div\", 1)(2, \"div\")(3, \"h1\");\n      i0.ɵɵtext(4, \"Who's Who\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵtemplate(5, HomeComponent_div_5_Template, 5, 2, \"div\", 0);\n      i0.ɵɵtemplate(6, HomeComponent_div_6_Template, 9, 1, \"div\", 0);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(7, \"div\")(8, \"app-button\", 2);\n      i0.ɵɵlistener(\"click\", function HomeComponent_Template_app_button_click_8_listener() {\n        return ctx.startGame();\n      });\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(9, \"app-button\", 3)(10, \"app-button\", 4);\n      i0.ɵɵelementEnd()();\n    }\n\n    if (rf & 2) {\n      i0.ɵɵproperty(\"ngIf\", ctx.authLoading || ctx.configLoading);\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"ngIf\", !ctx.authLoading && !ctx.configLoading);\n      i0.ɵɵadvance(1);\n      i0.ɵɵproperty(\"ngIf\", !ctx.authLoading && !ctx.configLoading);\n    }\n  },\n  dependencies: [i2.NgForOf, i2.NgIf, i3.NgSelectOption, i3.ɵNgSelectMultipleOption, i3.SelectControlValueAccessor, i3.NgControlStatus, i3.NgModel, i1.RouterLink, i4.ButtonComponent],\n  styles: [\".main-container[_ngcontent-%COMP%] {\\r\\n    display: flex;\\r\\n    flex-direction: column;\\r\\n    align-items: center;\\r\\n    justify-content: center;\\r\\n    height: 100vh;\\r\\n  }\\r\\n\\r\\n.button[_ngcontent-%COMP%] {\\r\\n  -webkit-appearance: button;\\r\\n          appearance: button;\\r\\n  -webkit-backface-visibility: hidden;\\r\\n          backface-visibility: hidden;\\r\\n  background-color: #405cf5;\\r\\n  border-radius: 6px;\\r\\n  border-width: 0;\\r\\n  box-shadow: rgba(50, 50, 93, .1) 0 0 0 1px inset,rgba(50, 50, 93, .1) 0 2px 5px 0,rgba(0, 0, 0, .07) 0 1px 1px 0;\\r\\n  box-sizing: border-box;\\r\\n  color: #fff;\\r\\n  cursor: pointer;\\r\\n  font-family: -apple-system,system-ui,\\\"Segoe UI\\\",Roboto,\\\"Helvetica Neue\\\",Ubuntu,sans-serif;\\r\\n  font-size: 100%;\\r\\n  height: 44px;\\r\\n  line-height: 1.15;\\r\\n  margin: 12px 0 0;\\r\\n  outline: none;\\r\\n  overflow: hidden;\\r\\n  padding: 0 25px;\\r\\n  position: relative;\\r\\n  text-align: center;\\r\\n  text-transform: none;\\r\\n  transform: translateZ(0);\\r\\n  transition: all .2s,box-shadow .08s ease-in;\\r\\n  user-select: none;\\r\\n  -webkit-user-select: none;\\r\\n  touch-action: manipulation;\\r\\n  width: 100%;\\r\\n}\\r\\n.button[_ngcontent-%COMP%]:disabled {\\r\\n  cursor: default;\\r\\n}\\r\\n.button[_ngcontent-%COMP%]:focus {\\r\\n  box-shadow: rgba(50, 50, 93, .1) 0 0 0 1px inset, rgba(50, 50, 93, .2) 0 6px 15px 0, rgba(0, 0, 0, .1) 0 2px 2px 0, rgba(50, 151, 211, .3) 0 0 0 4px;\\r\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3N0eWxlcy5jc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsOEVBQThFO0FBQzlFO0lBQ0ksYUFBYTtJQUNiLHNCQUFzQjtJQUN0QixtQkFBbUI7SUFDbkIsdUJBQXVCO0lBQ3ZCLGFBQWE7RUFDZjtBQUVBLDREQUE0RDtBQUU5RDtFQUNFLDBCQUFrQjtVQUFsQixrQkFBa0I7RUFDbEIsbUNBQTJCO1VBQTNCLDJCQUEyQjtFQUMzQix5QkFBeUI7RUFDekIsa0JBQWtCO0VBQ2xCLGVBQWU7RUFDZixnSEFBZ0g7RUFDaEgsc0JBQXNCO0VBQ3RCLFdBQVc7RUFDWCxlQUFlO0VBQ2YseUZBQXlGO0VBQ3pGLGVBQWU7RUFDZixZQUFZO0VBQ1osaUJBQWlCO0VBQ2pCLGdCQUFnQjtFQUNoQixhQUFhO0VBQ2IsZ0JBQWdCO0VBQ2hCLGVBQWU7RUFDZixrQkFBa0I7RUFDbEIsa0JBQWtCO0VBQ2xCLG9CQUFvQjtFQUNwQix3QkFBd0I7RUFDeEIsMkNBQTJDO0VBQzNDLGlCQUFpQjtFQUNqQix5QkFBeUI7RUFDekIsMEJBQTBCO0VBQzFCLFdBQVc7QUFDYjtBQUVBO0VBQ0UsZUFBZTtBQUNqQjtBQUVBO0VBQ0Usb0pBQW9KO0FBQ3RKIiwiZmlsZSI6ImhvbWUuY29tcG9uZW50LmNzcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIFlvdSBjYW4gYWRkIGdsb2JhbCBzdHlsZXMgdG8gdGhpcyBmaWxlLCBhbmQgYWxzbyBpbXBvcnQgb3RoZXIgc3R5bGUgZmlsZXMgKi9cclxuLm1haW4tY29udGFpbmVyIHtcclxuICAgIGRpc3BsYXk6IGZsZXg7XHJcbiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xyXG4gICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcclxuICAgIGp1c3RpZnktY29udGVudDogY2VudGVyO1xyXG4gICAgaGVpZ2h0OiAxMDB2aDtcclxuICB9XHJcblxyXG4gIC8qIFRha2VuIGZyb206IGh0dHBzOi8vZ2V0Y3Nzc2Nhbi5jb20vY3NzLWJ1dHRvbnMtZXhhbXBsZXMgKi9cclxuXHJcbi5idXR0b24ge1xyXG4gIGFwcGVhcmFuY2U6IGJ1dHRvbjtcclxuICBiYWNrZmFjZS12aXNpYmlsaXR5OiBoaWRkZW47XHJcbiAgYmFja2dyb3VuZC1jb2xvcjogIzQwNWNmNTtcclxuICBib3JkZXItcmFkaXVzOiA2cHg7XHJcbiAgYm9yZGVyLXdpZHRoOiAwO1xyXG4gIGJveC1zaGFkb3c6IHJnYmEoNTAsIDUwLCA5MywgLjEpIDAgMCAwIDFweCBpbnNldCxyZ2JhKDUwLCA1MCwgOTMsIC4xKSAwIDJweCA1cHggMCxyZ2JhKDAsIDAsIDAsIC4wNykgMCAxcHggMXB4IDA7XHJcbiAgYm94LXNpemluZzogYm9yZGVyLWJveDtcclxuICBjb2xvcjogI2ZmZjtcclxuICBjdXJzb3I6IHBvaW50ZXI7XHJcbiAgZm9udC1mYW1pbHk6IC1hcHBsZS1zeXN0ZW0sc3lzdGVtLXVpLFwiU2Vnb2UgVUlcIixSb2JvdG8sXCJIZWx2ZXRpY2EgTmV1ZVwiLFVidW50dSxzYW5zLXNlcmlmO1xyXG4gIGZvbnQtc2l6ZTogMTAwJTtcclxuICBoZWlnaHQ6IDQ0cHg7XHJcbiAgbGluZS1oZWlnaHQ6IDEuMTU7XHJcbiAgbWFyZ2luOiAxMnB4IDAgMDtcclxuICBvdXRsaW5lOiBub25lO1xyXG4gIG92ZXJmbG93OiBoaWRkZW47XHJcbiAgcGFkZGluZzogMCAyNXB4O1xyXG4gIHBvc2l0aW9uOiByZWxhdGl2ZTtcclxuICB0ZXh0LWFsaWduOiBjZW50ZXI7XHJcbiAgdGV4dC10cmFuc2Zvcm06IG5vbmU7XHJcbiAgdHJhbnNmb3JtOiB0cmFuc2xhdGVaKDApO1xyXG4gIHRyYW5zaXRpb246IGFsbCAuMnMsYm94LXNoYWRvdyAuMDhzIGVhc2UtaW47XHJcbiAgdXNlci1zZWxlY3Q6IG5vbmU7XHJcbiAgLXdlYmtpdC11c2VyLXNlbGVjdDogbm9uZTtcclxuICB0b3VjaC1hY3Rpb246IG1hbmlwdWxhdGlvbjtcclxuICB3aWR0aDogMTAwJTtcclxufVxyXG5cclxuLmJ1dHRvbjpkaXNhYmxlZCB7XHJcbiAgY3Vyc29yOiBkZWZhdWx0O1xyXG59XHJcblxyXG4uYnV0dG9uOmZvY3VzIHtcclxuICBib3gtc2hhZG93OiByZ2JhKDUwLCA1MCwgOTMsIC4xKSAwIDAgMCAxcHggaW5zZXQsIHJnYmEoNTAsIDUwLCA5MywgLjIpIDAgNnB4IDE1cHggMCwgcmdiYSgwLCAwLCAwLCAuMSkgMCAycHggMnB4IDAsIHJnYmEoNTAsIDE1MSwgMjExLCAuMykgMCAwIDAgNHB4O1xyXG59Il19 */\"]\n});","map":{"version":3,"mappings":"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","names":["fetchFromSpotify","request","i0","AUTH_ENDPOINT","TOKEN_KEY","HomeComponent","constructor","router","Pop","Rock","t","configLoading","genres","ngOnInit","authLoading","storedTokenString","localStorage","getItem","storedToken","JSON","parse","expiration","Date","now","console","log","token","value","loadGenres","then","access_token","expires_in","newToken","setItem","stringify","setGenre","selectedGenre","setDifficulty","selectedDifficulty","startGame","fetchTracks","artists","artistList","randomArtist","Math","floor","random","length","endpoint","params","q","type","limit","data","track","tracks","items","preview_url","navigateToPlayPage","error","catch","numOptions","getNumberOfChoices","correctArtist","name","wrongChoices","filter","artist","shuffledChoices","shuffleArray","slice","push","options","genre","navigate","state","array","sort","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["M:\\August Cohort\\angular-whos-who-aug-2024-team-4\\src\\app\\home\\home.component.ts","M:\\August Cohort\\angular-whos-who-aug-2024-team-4\\src\\app\\home\\home.component.html"],"sourcesContent":["import { Component, OnInit } from \"@angular/core\";\r\nimport fetchFromSpotify, { request } from \"../../services/api\";\r\nimport { Router } from '@angular/router';\r\n\r\nconst AUTH_ENDPOINT =\r\n  \"https://nuod0t2zoe.execute-api.us-east-2.amazonaws.com/FT-Classroom/spotify-auth-token\";\r\nconst TOKEN_KEY = \"whos-who-access-token\";\r\n\r\n@Component({\r\n  selector: \"app-home\",\r\n  templateUrl: \"./home.component.html\",\r\n  styleUrls: [\"./home.component.css\"],\r\n})\r\nexport class HomeComponent implements OnInit {\r\n  constructor(private router: Router) {}\r\n\r\n  genres: String[] = [];\r\n  selectedGenre: String = \"\";\r\n  selectedDifficulty = \"medium\"\r\n  authLoading: boolean = false;\r\n  configLoading: boolean = false;\r\n  token: String = \"\";\r\n  artistList: {[key: string]: string[]} = {\r\n    Pop: [\"Taylor Swift\", \"Justin Bieber\"],\r\n    Rock: [\"Led Zeppelin\", \"AC/DC\", \"Queen\", \"Beyoncé\"]\r\n  };\r\n\r\n  ngOnInit(): void {\r\n    this.authLoading = true;\r\n    const storedTokenString = localStorage.getItem(TOKEN_KEY);\r\n    if (storedTokenString) {\r\n      const storedToken = JSON.parse(storedTokenString);\r\n      if (storedToken.expiration > Date.now()) {\r\n        console.log(\"Token found in localstorage\");\r\n        this.authLoading = false;\r\n        this.token = storedToken.value;\r\n        this.loadGenres(storedToken.value);\r\n        return;\r\n      }\r\n    }\r\n    console.log(\"Sending request to AWS endpoint\");\r\n    request(AUTH_ENDPOINT).then(({ access_token, expires_in }) => {\r\n      const newToken = {\r\n        value: access_token,\r\n        expiration: Date.now() + (expires_in - 20) * 1000,\r\n      };\r\n      localStorage.setItem(TOKEN_KEY, JSON.stringify(newToken));\r\n      this.authLoading = false;\r\n      this.token = newToken.value;\r\n      this.loadGenres(newToken.value);\r\n    });\r\n  }\r\n\r\n  loadGenres = async (t: any) => {\r\n    this.configLoading = true;\r\n    this.genres = [\r\n      'Pop',\r\n      'Rock'\r\n    ]\r\n    this.configLoading = false;\r\n  }\r\n\r\n  setGenre(selectedGenre: any){\r\n    this.selectedGenre = selectedGenre;\r\n    console.log(this.selectedGenre);\r\n    //console.log(TOKEN_KEY);\r\n  }\r\n\r\n  setDifficulty(selectedDifficulty: any){\r\n    this.selectedDifficulty = selectedDifficulty;\r\n    console.log(this.selectedDifficulty)\r\n  }\r\n  startGame() {\r\n    if (!this.selectedGenre || !this.selectedDifficulty) {\r\n      return;\r\n    }\r\n\r\n    this.fetchTracks();\r\n  }\r\n\r\n  fetchTracks(){\r\n    const artists = this.artistList[this.selectedGenre as string]\r\n    const randomArtist = artists[Math.floor(Math.random() * artists.length)];\r\n    const endpoint = `search`;\r\n    const params = {\r\n      q: `artist:${randomArtist}`,\r\n      type: \"track\",\r\n      limit: 1,\r\n    };\r\n\r\n    fetchFromSpotify({ token: this.token, endpoint, params })\r\n      .then((data: any) => {\r\n        const track = data.tracks.items[0];\r\n        if (track && track.preview_url) {\r\n          this.navigateToPlayPage(track, artists);\r\n        } else {\r\n          console.error(\"No track preview available for the selected artist.\");\r\n        }\r\n      })\r\n      .catch((error: any) => {\r\n        console.error(\"Error fetching tracks:\", error);\r\n      });\r\n  }\r\n\r\n  navigateToPlayPage(track: any, artists: string[]) {\r\n    const numOptions = this.getNumberOfChoices();\r\n    const correctArtist = track.artists[0].name;\r\n  \r\n    const wrongChoices = artists.filter(artist => artist !== correctArtist);\r\n    const shuffledChoices = this.shuffleArray([...wrongChoices]).slice(0, numOptions - 1);\r\n    shuffledChoices.push(correctArtist);\r\n  \r\n    const options = this.shuffleArray(shuffledChoices);\r\n  \r\n    console.log(\"Navigating to play with state:\", {\r\n      track: track,\r\n      options: options,\r\n      correctArtist: correctArtist,\r\n      genre: this.selectedGenre,\r\n      token: this.token\r\n    });\r\n  \r\n    this.router.navigate(['play'], {\r\n      state: { \r\n        track: track,\r\n        options: options,\r\n        correctArtist: correctArtist,\r\n        genre: this.selectedGenre,\r\n        token: this.token \r\n      }\r\n    });\r\n  }\r\n\r\n  getNumberOfChoices() {\r\n    switch (this.selectedDifficulty) {\r\n      case 'easy':\r\n        return 3;\r\n      case 'medium':\r\n        return 4;\r\n      case 'hard':\r\n        return 5;\r\n      default:\r\n        return 4;\r\n    }\r\n  }\r\n\r\n  shuffleArray(array: any[]) {\r\n    return array.sort(() => Math.random() - 0.5);\r\n  }\r\n}\r\n\r\n  //Im going to leave the code they provided in comments bellow if in case we need it\r\n\r\n  // loadGenres = async (t: any) => {\r\n  //   this.configLoading = true;\r\n\r\n  //   // #################################################################################\r\n  //   // DEPRECATED!!! Use only for example purposes\r\n  //   // DO NOT USE the recommendations endpoint in your application\r\n  //   // Has been known to cause 429 errors\r\n  //   // const response = await fetchFromSpotify({\r\n  //   //   token: t,\r\n  //   //   endpoint: \"recommendations/available-genre-seeds\",\r\n  //   // });\r\n  //   // console.log(response);\r\n  //   // #################################################################################\r\n    \r\n  //   this.genres = [\r\n  //     \"rock\",\r\n  //     \"rap\",\r\n  //     \"pop\",\r\n  //     \"country\",\r\n  //     \"hip-hop\",\r\n  //     \"jazz\",\r\n  //     \"alternative\",\r\n  //     \"j-pop\",\r\n  //     \"k-pop\",\r\n  //     \"emo\"\r\n  //   ]\r\n  //   this.configLoading = false;\r\n  // };\r\n\r\n  // setGenre(selectedGenre: any) {\r\n  //   this.selectedGenre = selectedGenre;\r\n  //   console.log(this.selectedGenre);\r\n  //   console.log(TOKEN_KEY);\r\n  // }\r\n\r\n","<div *ngIf=\"authLoading || configLoading\">Loading...</div>\r\n\r\n<div class=\"main-container\">\r\n\r\n  <div>\r\n    <h1>Who's Who</h1>\r\n\r\n    <div *ngIf=\"!authLoading && !configLoading\">\r\n      Genre:\r\n      <select [(ngModel)]=\"selectedGenre\" (ngModelChange)=\"setGenre($event)\">\r\n        <option [value]=\"\"></option>\r\n        <option [value]=\"genre\" *ngFor=\"let genre of genres\">\r\n          {{ genre }}\r\n        </option>\r\n      </select>\r\n    </div>\r\n\r\n    <div *ngIf=\"!authLoading && !configLoading\">\r\n      Difficulty:\r\n      <select [(ngModel)]=\"selectedDifficulty\" (ngModelChange)=\"setDifficulty($event)\">\r\n        <option value=\"easy\">Easy</option>\r\n        <option value=\"medium\">Medium</option>\r\n        <option value=\"hard\">Hard</option>\r\n      </select>\r\n    </div>\r\n\r\n  </div>\r\n\r\n  <div>\r\n\r\n    <app-button buttonText=\"Play\" (click)=\"startGame()\" ></app-button>\r\n    <app-button buttonText=\"Leaderboard\" routerLink=\"/leaderboard\"></app-button>\r\n    <app-button buttonText=\"Game Over\" routerLink=\"/gameover\"></app-button>\r\n\r\n  </div>\r\n\r\n</div>"]},"metadata":{},"sourceType":"module"}